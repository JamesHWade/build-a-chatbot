<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="James Wade">
<meta name="dcterms.date" content="2024-02-17">

<title>build-a-chatbot - Build a Chatbot with OpenAI, Shiny, and RStudio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/fitvids-2.1.1/fitvids.min.js"></script>


</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-plan-for-today" id="toc-the-plan-for-today" class="nav-link active" data-scroll-target="#the-plan-for-today">The Plan for Today</a>
  <ul class="collapse">
  <li><a href="#clone-workshop-materials" id="toc-clone-workshop-materials" class="nav-link" data-scroll-target="#clone-workshop-materials">Clone Workshop Materials</a></li>
  </ul></li>
  <li><a href="#create-accounts-and-set-api-keys" id="toc-create-accounts-and-set-api-keys" class="nav-link" data-scroll-target="#create-accounts-and-set-api-keys">Create Accounts and Set API Keys</a></li>
  <li><a href="#suggested-resources" id="toc-suggested-resources" class="nav-link" data-scroll-target="#suggested-resources">Suggested Resources</a></li>
  <li><a href="#slides-for-today" id="toc-slides-for-today" class="nav-link" data-scroll-target="#slides-for-today">Slides for Today</a>
  <ul class="collapse">
  <li><a href="#part-1-generative-ai-in-rstudio" id="toc-part-1-generative-ai-in-rstudio" class="nav-link" data-scroll-target="#part-1-generative-ai-in-rstudio">Part 1: Generative AI in RStudio</a></li>
  <li><a href="#part-2-lets-build-a-chatbot" id="toc-part-2-lets-build-a-chatbot" class="nav-link" data-scroll-target="#part-2-lets-build-a-chatbot">Part 2: Let’s Build a Chatbot</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Build a Chatbot with OpenAI, Shiny, and RStudio</h1>
<p class="subtitle lead">Using GitHub Copilot, ChatGPT, and more in your favorite IDE</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>James Wade </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 17, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-plan-for-today" class="level2">
<h2 class="anchored" data-anchor-id="the-plan-for-today">The Plan for Today</h2>
<p>My plan is to talk as little as possible and let you all play with the tools. I’ll give a brief overview of the tools and then we’ll jump into an interactive workshop where we will build a chatbot.</p>
<p>It may take a few minutes to setup your environment. The best way to do this is to clone this repo and open the project in RStudio. Here’s a link to the repo: <a href="https://github.com/jameshwade/build-a-chatbot">build-a-chatbot</a>.</p>
<section id="clone-workshop-materials" class="level3">
<h3 class="anchored" data-anchor-id="clone-workshop-materials">Clone Workshop Materials</h3>
<p>There are two easy ways to clone the repo. You can use RStudio built-in buttons or the <code>{usethis}</code> package.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Clone with RStudio</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Clone with <code>{usethis}</code></a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>To clone the repo, open RStudio and go to <code>File &gt; New Project &gt; Version Control &gt; Git</code> and paste in the following URL: <a href="https://github.com/JamesHWade/build-a-chatbot" class="uri">https://github.com/JamesHWade/build-a-chatbot</a></p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="slides/media/clone-repo.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
<figcaption>Clone git repository with RStudio</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>You can also use the following code to clone the packages we’ll be using today.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("usethis")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(usethis)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">create_from_github</span>(<span class="st">"jameshwade/build-a-chatbot"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fork =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>This repo uses <code>{renv}</code> to help create a reproducible environment. When you clone and open the package in RStudio, you should be prompted to install the packages. If not, you can run the following code to install the packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("renv")</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="create-accounts-and-set-api-keys" class="level2">
<h2 class="anchored" data-anchor-id="create-accounts-and-set-api-keys">Create Accounts and Set API Keys</h2>
<p>With <code>{gptstudio}</code> and <code>{gpttools}</code>, you can use any of seven AI services. You’ll need to create an account with the service you want to use. Here’s a list of the services and links to the documentation and setup instructions:</p>
<table class="table">
<thead>
<tr class="header">
<th>AI Service</th>
<th>Models</th>
<th>Documentation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://platform.openai.com">OpenAI</a></td>
<td>gpt-4-turbo, gpt-4, gpt-3.5-turbo (<a href="https://platform.openai.com/docs/models">latest models</a>)</td>
<td><a href="https://platform.openai.com/docs/api-reference">OpenAI API Docs</a></td>
</tr>
<tr class="even">
<td><a href="https://huggingface.co/">HuggingFace</a></td>
<td>various</td>
<td><a href="https://huggingface.co/docs/hub/models-inference">HF Inference API Docs</a></td>
</tr>
<tr class="odd">
<td><a href="https://docs.anthropic.com/claude/docs/guide-to-anthropics-prompt-engineering-resources">Anthropic</a></td>
<td>claude-2.1, claude-instant-1.2</td>
<td><a href="https://docs.anthropic.com/claude/reference/getting-started-with-the-api">Anthropic API Docs</a></td>
</tr>
<tr class="even">
<td><a href="https://ollama.ai/">Ollama</a></td>
<td>mistral, llama2, mixtral, phi (<a href="https://ollama.ai/library">latest models</a>)</td>
<td><a href="https://github.com/jmorganca/ollama/blob/main/docs/api.md">Ollama API Docs</a></td>
</tr>
<tr class="odd">
<td><a href="https://www.perplexity.ai">Perplexity</a></td>
<td>pplx-7b-chat, pplx-70b-chat, pplx-7b-online, pplx-70b-online, llama-2-70b-chat, codellama-34b-instruct, mistral-7b-instruct, and mixtral-8x7b-instruct</td>
<td><a href="https://docs.perplexity.ai/reference/post_chat_completions">Perplexity API Docs</a></td>
</tr>
<tr class="even">
<td><a href="https://ai.google.dev/tutorials/ai-studio_quickstart">Google AI Studio</a></td>
<td>Gemini and Palm (legacy)</td>
<td><a href="https://ai.google.dev/docs">Google AI Studio Docs</a></td>
</tr>
<tr class="odd">
<td><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/overview">Azure OpenAI</a></td>
<td>gpt-4, gpt-3.5-turbo (<a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-4-and-gpt-4-turbo-preview">latest models</a>)</td>
<td><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/quickstart?tabs=command-line,python&amp;pivots=rest-api">Azure OpenAI API Docs</a></td>
</tr>
</tbody>
</table>
<p>Follow instructions for your chosen service to create an account and get an API key. You’ll need to add the API key to your <code>.Renviron</code> file. Here are instructions for each service:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">OpenAI</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">HuggingFace</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Anthropic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Ollama</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Perplexity</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">Google AI Studio</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false">Azure OpenAI</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<section id="creating-an-openai-account" class="level4">
<h4 class="anchored" data-anchor-id="creating-an-openai-account">Creating an OpenAI Account</h4>
<ul>
<li>Visit <a href="https://openai.com/">OpenAI’s website</a> and sign up for an account.</li>
<li>Follow the instructions to verify your account.</li>
</ul>
</section>
<section id="creating-an-openai-api-key" class="level4">
<h4 class="anchored" data-anchor-id="creating-an-openai-api-key">Creating an OpenAI API Key</h4>
<ul>
<li>Once logged in, navigate to the API section in your account settings.</li>
<li>Follow the instructions to create a new API key. More detailed steps can be found in OpenAI’s <a href="https://beta.openai.com/docs/">API documentation</a>.</li>
</ul>
</section>
<section id="setting-the-openai-api-key-in-.renviron" class="level4">
<h4 class="anchored" data-anchor-id="setting-the-openai-api-key-in-.renviron">Setting the OpenAI API Key in .Renviron</h4>
<p>To modify the <code>.Renviron</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(usethis) </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">edit_r_environ</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a persistent setting, add the following line to <code>.Renviron</code>, replacing <code>"&lt;APIKEY&gt;"</code> with your actual API key:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">OPENAI_API_KEY</span><span class="op">=</span><span class="st">"&lt;APIKEY&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Save the file and restart your R session for the changes to take effect.</p>
<p><strong>Caution:</strong> Ensure <code>.Renviron</code> is included in your <code>.gitignore</code> file to avoid exposing your API key with version control systems like GitHub or GitLab.</p>
<p><strong>Important Note:</strong> OpenAI API requires valid payment details in your OpenAI account to function. This is a restriction imposed by OpenAI and is unrelated to this package.</p>
</section>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<section id="creating-a-huggingface-account" class="level4">
<h4 class="anchored" data-anchor-id="creating-a-huggingface-account">Creating a HuggingFace Account</h4>
<ul>
<li>Visit <a href="https://huggingface.co/">HuggingFace’s website</a> and sign up for an account.</li>
<li>Complete the account verification process.</li>
</ul>
</section>
<section id="creating-a-huggingface-api-key" class="level4">
<h4 class="anchored" data-anchor-id="creating-a-huggingface-api-key">Creating a HuggingFace API Key</h4>
<ul>
<li>After logging in, go to your account settings.</li>
<li>Find the section for API keys and create a new one. Detailed guidance is available in HuggingFace’s API documentation.</li>
</ul>
</section>
<section id="setting-the-huggingface-api-key-in-.renviron" class="level4">
<h4 class="anchored" data-anchor-id="setting-the-huggingface-api-key-in-.renviron">Setting the HuggingFace API Key in .Renviron</h4>
<p>To modify the <code>.Renviron</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(usethis)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">edit_r_environ</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a persistent setting, add the following line to <code>.Renviron</code>, replacing <code>"&lt;APIKEY&gt;"</code> with your actual HuggingFace API key:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="va">HF_API_KEY</span><span class="op">=</span><span class="st">"&lt;APIKEY&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Save the file and restart your R session for the changes to take effect.</p>
<p><strong>Caution:</strong> Remember to include <code>.Renviron</code> in your <code>.gitignore</code> file to prevent exposing your API key, especially if using version control systems like GitHub or GitLab.</p>
</section>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<section id="creating-an-anthropic-account" class="level4">
<h4 class="anchored" data-anchor-id="creating-an-anthropic-account">Creating an Anthropic Account</h4>
<ul>
<li>Go to the <a href="https://www.anthropic.com/">Anthropic website</a> and sign up.</li>
<li>Verify your account as instructed.</li>
</ul>
</section>
<section id="creating-an-anthropic-api-key" class="level4">
<h4 class="anchored" data-anchor-id="creating-an-anthropic-api-key">Creating an Anthropic API Key</h4>
<ul>
<li>Log into your Anthropic account and navigate to the API section.</li>
<li>Create an API key following their guidelines. Check Anthropic’s API documentation for more details.</li>
</ul>
</section>
<section id="setting-the-anthropic-api-key-in-.renviron" class="level4">
<h4 class="anchored" data-anchor-id="setting-the-anthropic-api-key-in-.renviron">Setting the Anthropic API Key in .Renviron</h4>
<p>To modify the <code>.Renviron</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(usethis)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">edit_r_environ</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a persistent setting, add the following line to <code>.Renviron</code>, replacing <code>"&lt;APIKEY&gt;"</code> with your actual Anthropic API key:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="va">ANTHROPIC_API_KEY</span><span class="op">=</span><span class="st">"&lt;APIKEY&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Save the file and restart your R session for the changes to take effect.</p>
<p><strong>Caution:</strong> Ensure <code>.Renviron</code> is not exposed if using version control systems.</p>
</section>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<p>The <a href="https://github.com/jmorganca/ollama">ollama</a> service allows you to run open source LLMs locally, providing a command line interface and an API. By wrapping the later, we can use it within our chat app.</p>
<p>You can run ollama in any platform as a docker container. The following code runs the CPU-only version:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">-v</span> ollama:/root/.ollama <span class="at">-p</span> 11434:11434 <span class="at">--name</span> ollama ollama/ollama</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code:</p>
<ol type="1">
<li>pulls the latest ollama image from the ollama hub (<code>ollama/ollama</code>)</li>
<li>exposes the ollama API in <code>http://localhost:11434</code> (<code>-p 11434:11434</code>)</li>
<li>sets up the ollama volume, to be used in the “/root/.ollama” path inside the container. this will allow you to update the container later without losing your already downloaded models. (<code>-v ollama:/root/.ollama</code>)</li>
<li>assigns the name “ollama” to the container (<code>--name ollama</code>)</li>
<li>runs the container in detached mode (<code>docker run -d</code>)</li>
</ol>
<p>You can see more docker options in the <a href="https://ollama.ai/blog/ollama-is-now-available-as-an-official-docker-image">official blog post</a>.</p>
<p>Before using the service, you need to pull a model. Run the following code inside your container to pull llama2:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ollama</span> pull llama2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Check the <a href="https://ollama.ai/library">ollama library</a> to see more models. For more advanced install options, check the <a href="https://github.com/jmorganca/ollama">official documentation</a>.</p>
<p>By default, the chat addin will use <code>http://localhost:11434</code> to locate the ollama API. You can customize this by setting up the <code>OLLAMA_HOST</code> environmental variable with <code>usethis::edit_r_environ()</code>.</p>
<section id="an-example-with-ollama" class="level4">
<h4 class="anchored" data-anchor-id="an-example-with-ollama">An Example with Ollama</h4>
<p>Here is a short video showing you how to get started with ollama. It assumes that you have already installed docker. See the docker <a href="https://docs.docker.com/get-docker/">installation guide</a> for more information.</p>
<p><img src="https://raw.githubusercontent.com/MichelNivard/gptstudio/main/media/gptstudio-ollama-example.gif" class="img-fluid" width="700"></p>
</section>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<section id="creating-an-perplexity-account" class="level4">
<h4 class="anchored" data-anchor-id="creating-an-perplexity-account">Creating an Perplexity Account</h4>
<ul>
<li>Go to the <a href="https://perplexity.ai/">Perplexity website</a> and sign up.</li>
<li>Verify your account as instructed.</li>
</ul>
</section>
<section id="creating-an-perplexity-api-key" class="level4">
<h4 class="anchored" data-anchor-id="creating-an-perplexity-api-key">Creating an Perplexity API Key</h4>
<ul>
<li>Log into your Perplexity account and navigate to the <a href="https://docs.perplexity.ai/">API documentation</a>.</li>
<li>Create an API key following their guidelines. Check Perplexity’s API documentation for more details.</li>
</ul>
</section>
<section id="setting-the-perplexity-api-key-in-.renviron" class="level4">
<h4 class="anchored" data-anchor-id="setting-the-perplexity-api-key-in-.renviron">Setting the Perplexity API Key in .Renviron</h4>
<p>To modify the <code>.Renviron</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(usethis)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">edit_r_environ</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a persistent setting, add the following line to <code>.Renviron</code>, replacing <code>"&lt;APIKEY&gt;"</code> with your actual Perplexity API key:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="va">PERPLEXITY_API_KEY</span><span class="op">=</span><span class="st">"&lt;APIKEY&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Save the file and restart your R session for the changes to take effect.</p>
<p><strong>Caution:</strong> Ensure <code>.Renviron</code> is not exposed if using version control systems.</p>
</section>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<section id="creating-an-account-in-googles-ai-studio" class="level4">
<h4 class="anchored" data-anchor-id="creating-an-account-in-googles-ai-studio">Creating an Account in Google’s AI Studio</h4>
<ul>
<li>Visit <a href="https://makersuite.google.com">Google’s AI Studio website</a> and sign up.</li>
<li>Complete the verification process.</li>
</ul>
</section>
<section id="accessing-google-palm-api" class="level4">
<h4 class="anchored" data-anchor-id="accessing-google-palm-api">Accessing Google PALM API</h4>
<ul>
<li>In your Google Cloud Console, enable the PALM API.</li>
<li>Create an API key as per the instructions in <a href="https://ai.google.dev/docs">Google’s API documentation</a>.</li>
</ul>
</section>
<section id="setting-the-google-ai-studio-api-key-in-.renviron" class="level4">
<h4 class="anchored" data-anchor-id="setting-the-google-ai-studio-api-key-in-.renviron">Setting the Google AI Studio API Key in .Renviron</h4>
<p>To modify the <code>.Renviron</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(usethis)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">edit_r_environ</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a persistent setting, add the following line to <code>.Renviron</code>, replacing <code>"&lt;APIKEY&gt;"</code> with your actual Google PALM API key:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="va">PALM_API_KEY</span><span class="op">=</span><span class="st">"&lt;APIKEY&gt;"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Save the file and restart your R session for the changes to take effect.</p>
<p><strong>Caution:</strong> Be careful not to expose <code>.Renviron</code> in public repositories or version control systems to protect your API key.</p>
</section>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<p>To configure gptstudio to work using Azure OpenAI service, you need to provide some configuration details in your .Renviron file. Specifically, gptstudio looks for five environment variables:</p>
<ul>
<li>AZURE_OPENAI_TASK</li>
<li>AZURE_OPENAI_ENDPOINT</li>
<li>AZURE_OPENAI_DEPLOYMENT_NAME</li>
<li>AZURE_OPENAI_KEY</li>
<li>AZURE_OPENAI_API_VERSION</li>
</ul>
<p>Here’s how you can add these details to your .Renviron file:</p>
<ol type="1">
<li>Locate your .Renviron file with <code>usethis::edit_r_environ()</code>.</li>
<li>Add environment variable details: Add a new line for each variable you need to set in the following format: VARIABLE_NAME=“YOUR_VALUE”. Replace VARIABLE_NAME with the name of the environment variable and YOUR_VALUE with the actual value that you want to set. For example, to set the API key you would have a line like this:</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_OPENAI_KEY</span><span class="op">=</span><span class="st">"your_actual_key_goes_here"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You need to do this for each of the environment variables expected by the function. Your .Renviron file should look something like this:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_OPENAI_TASK</span><span class="op">=</span><span class="st">"your_task_code"</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_OPENAI_ENDPOINT</span><span class="op">=</span><span class="st">"your_endpoint_url"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_OPENAI_DEPLOYMENT_NAME</span><span class="op">=</span><span class="st">"your_deployment_name"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_OPENAI_KEY</span><span class="op">=</span><span class="st">"your_api_key"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_OPENAI_API_VERSION</span><span class="op">=</span><span class="st">"your_api_version"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Save and Close .Renviron: After adding your environment variables, save your .Renviron file and close it. You will need to restart your R session to make sure the new environment variables are loaded properly.</li>
</ol>
<p>Remember to replace your_task_code, your_endpoint_url, your_deployment_name, your_api_key, and your_api_version with your actual Azure OpenAI details. You can retrieve these details from your Azure OpenAI service account. For more information about Azure OpenAI configuration, refer to the <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/quickstart?tabs=command-line&amp;pivots=rest-api">Microsoft quickstart guide</a>.</p>
</div>
</div>
</div>
</section>
<section id="suggested-resources" class="level2">
<h2 class="anchored" data-anchor-id="suggested-resources">Suggested Resources</h2>
<ul>
<li><a href="&quot;https://pos.it/rstudio-copilot">GitHub Copilot in RStudio, it’s finally here!</a> by Tom Mock, Product Manager of RStudio Workbench</li>
<li><a href="https://michelnivard.github.io/gptstudio/"><code>{gptstudio}</code></a> - An R package that integrates LLMs into RStudio</li>
<li><a href="https://jameshwade.github.io/gpttools/"><code>{gpttools}</code></a> - A sister package to <code>{gptstudio}</code> that allows RAG to supplement LLMs</li>
<li><a href="https://github.com/mlverse/chattr"><code>{chattr}</code></a> - A package from the <a href="https://github.com/mlverse">mlverse</a> team to integrates LLM’s with the RStudio by Edgar Ruiz, Posit Software Engineer</li>
</ul>
</section>
<section id="slides-for-today" class="level2">
<h2 class="anchored" data-anchor-id="slides-for-today">Slides for Today</h2>
<section id="part-1-generative-ai-in-rstudio" class="level3">
<h3 class="anchored" data-anchor-id="part-1-generative-ai-in-rstudio">Part 1: Generative AI in RStudio</h3>
<div class="shareagain" style="min-width:300px;margin:0 auto;" data-exeternal="1">
<iframe src="slides/slides_gen-ai.html" width="1600" height="900" style="border:none;" loading="lazy" allowfullscreen=""></iframe>
<script>fitvids('.shareagain', {players: 'iframe'});</script>
</div>
<p class="text-center buttons">
</p><p><a class="btn btn-primary" target="_blank" href="slides/slides_gen-ai.html"><i class="fa-solid fa-arrow-up-right-from-square"></i> View all slides in new window</a></p>
</section>
<section id="part-2-lets-build-a-chatbot" class="level3">
<h3 class="anchored" data-anchor-id="part-2-lets-build-a-chatbot">Part 2: Let’s Build a Chatbot</h3>
<div class="shareagain" style="min-width:300px;margin:0 auto;" data-exeternal="1">
<iframe src="slides/slides_chat-bot.html" width="1600" height="900" style="border:none;" loading="lazy" allowfullscreen=""></iframe>
<script>fitvids('.shareagain', {players: 'iframe'});</script>
</div>
<p class="text-center buttons">
</p><p><a class="btn btn-primary" target="_blank" href="slides/slides_chat-bot.html"><i class="fa-solid fa-arrow-up-right-from-square"></i> View all slides in new window</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>